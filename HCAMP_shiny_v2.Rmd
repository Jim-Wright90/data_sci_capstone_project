---
title: "Educational Data Science Capstone Project"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
    source_code: embed
    vertical_layout: scroll
    theme: united
resource_files:
- data/rtl_description.xlsx
- data/rtp_steps.xlsx
- data/cluster_scores.xlsx
- data/pcss_items.xlsx
- data/impact_data.csv
- data/four_post_injury_test_impact_sims_merge.csv
- data/three_post_injury_test_impact_sims_merge.csv
- data/two_post_injury_test_impact_sims_merge.csv
- data/one_post_injury_test_impact_sims_merge.csv
- data/four_post_injury_impact_test.csv
- data/three_post_injury_impact_test.csv
- data/two_post_injury_impact_test.csv
- data/one_post_injury_impact_test.csv
- data/sims_concussion_data.csv
---

```{r setup, include=FALSE}
library(shiny)
library(flexdashboard)
library(tidyverse)
library(here)
library(janitor)
library(rio)
library(colorblindr)
library(gghighlight)
library(forcats)
library(ggrepel)
library(knitr)
library(kableExtra)
library(reactable)
library(plotly)
library(glue)
library(fs)
library(rstatix)
library(ggpubr)
library(writexl) 
library(remotes)
library(profvis) 
library(scales)


library(RcppArmadillo)

# theme_set(theme_minimal(15) +
#             theme(legend.position = "bottom",
#                   panel.grid.major.x = element_line(color = "gray60"),
#                   panel.grid.minor.x = element_blank(),
#                   panel.grid.major.y = element_blank())
#           )

theme_fivethirtyeight <- function(base_size = 15, base_family = "") {
  theme_grey(base_size = base_size, base_family = base_family) %+replace%
    theme(

      # Base elements which are not used directly but inherited by others
      line =              element_line(colour = '#DADADA', size = 0.75,
                                       linetype = 1, lineend = "butt"),
      rect =              element_rect(fill = "#F0F0F0", colour = "#F0F0F0",
                                       size = 0.5, linetype = 1),
      text =              element_text(family = base_family, face = "plain",
                                       colour = "#656565", size = base_size,
                                       hjust = 0.5, vjust = 0.5, angle = 0,
                                       lineheight = 0.9),

      # Modified inheritance structure of text element
      plot.title =        element_text(size = rel(1.5), family = '' ,
                                       face = 'bold', hjust = -0.05,
                                       vjust = 1.5, colour = '#3B3B3B'),
      axis.title.x =      element_blank(),
      axis.title.y =      element_blank(),
      axis.text =         element_text(),

      # Modified inheritance structure of line element
      axis.ticks =        element_line(),
      panel.grid.major =  element_line(),
      panel.grid.minor =  element_blank(),

      # Modified inheritance structure of rect element
      plot.background =   element_rect(),
      panel.background =  element_rect(),
      legend.key =        element_rect(colour = '#DADADA'),

      # Modifiying legend.position
      legend.position = 'none',

      complete = TRUE
    )
}


theme_set(theme_fivethirtyeight())

```

```{r global, include=FALSE}
#all clean sims data
sims_concussion_data <- read_csv(here("data", "sims_concussion_data.csv"))

sims_concussion_data <- sims_concussion_data %>% 
  mutate(age = as.factor(age))

#impact data only

one_impact_test <- read_csv(here("data", "one_post_injury_impact_test.csv"))

two_impact_test <- read_csv(here("data", "two_post_injury_impact_test.csv"))

three_impact_test <- read_csv(here("data", "three_post_injury_impact_test.csv"))

four_impact_test <- read_csv(here("data", "four_post_injury_impact_test.csv"))

# impact sims merge data

one_impact_sims <- read_csv(here("data", "one_post_injury_test_impact_sims_merge.csv"))

two_impact_sims <- read_csv(here("data", "two_post_injury_test_impact_sims_merge.csv"))

three_impact_sims <- read_csv(here("data", "three_post_injury_test_impact_sims_merge.csv"))

four_impact_sims <- read_csv(here("data", "four_post_injury_test_impact_sims_merge.csv"))

# pcss items 

pcss_items <- import(here("data", "pcss_items.xlsx"),
               setclass = "tbl_df") 

pcss_items_data <- import(here("data", "pcss_items_data.xlsx"),
               setclass = "tbl_df") 

pcss_cluster <- import(here("data", "cluster_scores.xlsx"),
               setclass = "tbl_df") 
```


# Data Overview 

Sidebar {.sidebar}
------------

**SIMS Data Variable Exploration**

```{r, include=TRUE}
selectInput("var1", "Total Concussion Plots:",
            choices = c("Gender" = "gender",
                        "Age" = "age",
                        "League" = "league",
                        "Sport Level" = "level"))

selectInput("var2", "Total Concussion Tables:",
            choices = c("School" = "school",
                        "Sport" = "sport"))

```


**SIMS RTL/RTP Information**

```{r, inlcude=TRUE}

selectInput("bins1", "Number of Bins",
            choices = c(10, 25, 40, 55), selected = 25)

selectInput("var3", "RTL/RTP Tables:",
            choices = c("Gender" = "gender",
                        "Age" = "age",
                        "League" = "league",
                        "School" = "school",
                        "Sport" = "sport",
                        "Sport Level" = "level"))

```


**_Data Description:_** The data for this capstone project was provided by the Hawaii Concussion Awareness and Management Program [(HCAMP)](https://hawaiiconcussion.com/), which is an organization affiliated with the University of Hawaii. The mission of HCAMP is to develop evidence-based interventions to manage concussion. 

The specific goal of this project is to explore trends from two data sets. The first data set contains multiple years of test and symptom severity scores from the Immediate Post-Concussion Assessment and Cognitive Testing [(ImPACT)](https://impactconcussion.com/) software. The second data set contains multiple years of return-to-learn (RTL) and return-to-play (RTP) outcome data from the Hawaii Department of Education Student Information Management System (SIMS). The ImPACT data set is utilized to explore trends in symptom severity, as measured by the [Post-Concussion Symptom Scale (PCSS)](tools/Post-Concussion-Symptom-Scale1.pdf), across individuals who completed post-injury testing following their concussion. The ImPACT data set is divided into four smaller data sets to represent individuals who completed one post-injury test, two post-injury tests, three post-injury tests, and four post-injury tests. Specific to this data set, the following research question is explored: Is there a significant difference between PCSS cluster symptom scores during the recovery process? The six symptom clusters used for this project are adapted from Lumba-Brown et al. (2019) and Harmon et al. (2019). 

The SIMS data set is utilized to explore trends in the duration of time to complete RTL and RTP protocols. The ImPACT and SIMS data sets have been joined corresponding to the number of post-injury tests completed from the ImPACT data set. Although the merger of these data sets did not yield a large number of observations to analyze, the following research question is explored: What is the relationship between symptom severity scores and RTL/RTP duration? 

Row {.tabset}
-----------------------------------------------------------------------

### Concussion Totals 1

```{r}
# Define inputs 

renderPlotly({
  sims_concussion_data %>%
    ggplot(aes_string(input$var1)) +
    geom_bar(fill = "#772953",
             alpha = 0.7) +
    coord_flip() +
    labs(x = "",
         y = "Total Concussions")
})


```

### Concussion Totals 2

```{r, include=FALSE}
tbl_1 <- reactive({
  sims_concussion_data %>%
  group_by_at({{input$var2}}) %>%
  summarize(total = n()) %>%
  arrange(desc(total)) %>%
  reactable(
    defaultColDef = colDef(align = "center"),
    columns = list(
      total = colDef(name = "Total",
                     format = colFormat(suffix = " concussions"))),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(tbl_1())
```


Row {.tabset}
-----------------------------------------------------------------------

### RTL 1

```{r, include=TRUE}
renderPlotly({
  sims_concussion_data %>% 
    ggplot(aes(dys_btwn_onset_rtp_3)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var1) +
    labs(x = "Days to Complete RTL",
         y = "")
})
```

### RTL 2

```{r, include=FALSE}
rtl_tbl <- reactive({
  sims_concussion_data %>%
  group_by_at({{input$var3}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_3),
            SD = sd(dys_btwn_onset_rtp_3),
            Min = min(dys_btwn_onset_rtp_3),
            Max = max(dys_btwn_onset_rtp_3),
            Total = length(dys_btwn_onset_rtp_3)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(rtl_tbl())
```

### RTP 1

```{r, include=TRUE}
renderPlotly({
  sims_concussion_data %>% 
    ggplot(aes(dys_btwn_onset_rtp_7)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var1) +
    labs(x = "Days to Complete RTP",
         y = "")
})
```

### RTP 2

```{r, include=FALSE}
rtp_tbl <- reactive({
  sims_concussion_data %>%
  group_by_at({{input$var3}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_7),
            SD = sd(dys_btwn_onset_rtp_7),
            Min = min(dys_btwn_onset_rtp_7),
            Max = max(dys_btwn_onset_rtp_7),
            Total = length(dys_btwn_onset_rtp_7)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(rtp_tbl())
```

Row {.tabset}
-----------------------------------------------------------------------

### ImPACT Test Totals

```{r, include=FALSE}
t_sum_pi <- data.frame("Level" = c("One Post-Injury Test",
                                  "Two Post-Injury Tests",
                                  "Three Post-Injury Tests",
                                  "Four Post-Injury Tests"),
                      "Total" = c(nrow(one_impact_test),
                                  nrow(two_impact_test),
                                  nrow(three_impact_test),
                                  nrow(four_impact_test)))
```

```{r, include=FALSE}
pi_plot <- ggplot(t_sum_pi, aes(fct_reorder(Level, Total), Total)) +
  geom_col(fill = "#772953",
           alpha = 0.7) +
  scale_y_continuous(labels = function(x) format(x, big.mark = ",",
                                                 scientific = FALSE)) +
  coord_flip() +
  labs(x = "",
       y = "Individuals")
```

```{r, include=TRUE}
ggplotly(pi_plot)
```

### PCSS Item Description

```{r}
pcss_items %>% 
  reactable(columns = list(
    Item = colDef(name = "Item",
                   align = "center"),
    Symptom = colDef(name = "Symptom", 
                   align = "center"),
    Cluster = colDef(name = "Cluster",
                     align = "center")),
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE,
    searchable = TRUE)
```

### PCSS Symptom Clusters

```{r, include=FALSE}

pcss_cluster_plot <- ggplot(pcss_cluster, aes(fct_reorder(Cluster, `Total Possible Severity Score`),
                                              `Total Possible Severity Score`)) +
  geom_col(fill = "#772953",
           alpha = 0.7) +
  scale_y_continuous(limits = c(0, 30),
                     breaks = c(0, 5, 10, 15, 20, 25, 30)) +
  coord_flip() +
  labs(x = "",
       y = "Total Possible Severity Score",
       caption = "Total Possible Severity Score = 132")
```

```{r, include=TRUE}
ggplotly(pcss_cluster_plot)
```


# PCSS Ratings  

Sidebar {.sidebar}
------------

**One Post-Injury Test**

```{r, include=TRUE}

selectInput("var5", "Demographic Variables:",
            choices = c("Gender" = "gender",
                        "Age" = "age"))

selectInput("var4", "Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_1",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_1",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_1",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_1",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_1",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_1",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_1"))

```

**Two Post-Injury Tests**

```{r, include=TRUE}

selectInput("var8", "Demographic Variables:",
            choices = c("Gender" = "gender",
                        "Age" = "age_post_injury_1"))

selectInput("var6", "Test 1 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_1",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_1",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_1",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_1",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_1",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_1",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_1"))

selectInput("var7", "Test 2 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_2",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_2",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_2",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_2",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_2",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_2",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_2"))

```


**Three Post-Injury Tests**

```{r, include=TRUE}

selectInput("var12", "Demographic Variables:",
            choices = c("Gender" = "gender",
                        "Age" = "age_post_injury_1"))

selectInput("var9", "Test 1 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_1",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_1",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_1",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_1",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_1",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_1",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_1"))

selectInput("var10", "Test 2 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_2",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_2",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_2",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_2",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_2",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_2",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_2"))

selectInput("var11", "Test 3 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_3",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_3",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_3",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_3",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_3",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_3",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_3"))
```

**Four Post-Injury Tests**

```{r, include=TRUE}

selectInput("var17", "Demographic Variables:",
            choices = c("Gender" = "gender",
                        "Age" = "age_post_injury_1"))

selectInput("var13", "Test 1 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_1",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_1",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_1",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_1",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_1",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_1",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_1"))

selectInput("var14", "Test 2 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_2",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_2",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_2",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_2",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_2",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_2",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_2"))

selectInput("var15", "Test 3 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_3",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_3",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_3",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_3",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_3",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_3",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_3"))

selectInput("var16", "Test 4 Symptom Cluster:",
            choices = c("Total Sympom Score" = "total_symptom_score_post_injury_4",
                        "Headache-Migraine Cluster" = "headache_migraine_cluster_score_post_injury_4",
                        "Cognitive Cluster" = "cognitive_cluster_score_post_injury_4",
                        "Anxiety-Mood Cluster" = "anxiety_mood_cluster_score_post_injury_4",
                        "Ocular-Motor Cluster" = "ocular_motor_cluster_score_post_injury_4",
                        "Vestibular Cluster" = "vestibular_cluster_score_post_injury_4",
                        "Sleep Cluster" = "sleep_cluster_score_post_injury_4"))
```


Row {.tabset}
-----------------------------------------------------------------------

### One Test Plots 

```{r, include=TRUE}
renderPlotly({
  one_impact_test %>% 
    ggplot(aes_string(input$var4)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var5) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### One Test Tables 

```{r, include=FALSE}
one_pi_tbl <- reactive({
  one_impact_test %>%
  group_by_at({{input$var5}}) %>%
  summarize(Mean = mean(!!sym(input$var4)),
            SD = sd(!!sym(input$var4)),
            Min = min(!!sym(input$var4)),
            Max = max(!!sym(input$var4)),
            Total = length(!!sym(input$var4))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(one_pi_tbl())
```



Row {.tabset}
-----------------------------------------------------------------------

### Two Tests Plots - Test 1 

```{r, include=TRUE}
renderPlotly({
  two_impact_test %>% 
    ggplot(aes_string(input$var6)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var8) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Two Tests Tables - Test 1 

```{r, include=FALSE}
two_pi_tbl_1 <- reactive({
  two_impact_test %>%
  group_by_at({{input$var8}}) %>%
  summarize(Mean = mean(!!sym(input$var6)),
            SD = sd(!!sym(input$var6)),
            Min = min(!!sym(input$var6)),
            Max = max(!!sym(input$var6)),
            Total = length(!!sym(input$var6))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(two_pi_tbl_1())
```


### Two Tests Plots - Test 2

```{r, include=TRUE}
renderPlotly({
  two_impact_test %>% 
    ggplot(aes_string(input$var7)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var8) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Two Tests Tables - Test 2

```{r, include=FALSE}
two_pi_tbl_2 <- reactive({
  two_impact_test %>%
  group_by_at({{input$var8}}) %>%
  summarize(Mean = mean(!!sym(input$var7)),
            SD = sd(!!sym(input$var7)),
            Min = min(!!sym(input$var7)),
            Max = max(!!sym(input$var7)),
            Total = length(!!sym(input$var7))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(two_pi_tbl_2())
```

Row {.tabset}
-----------------------------------------------------------------------

### Three Tests Plots - Test 1 

```{r, include=TRUE}
renderPlotly({
  three_impact_test %>% 
    ggplot(aes_string(input$var9)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var12) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Three Tests Tables - Test 1

```{r, include=FALSE}
three_pi_tbl_1 <- reactive({
  three_impact_test %>%
  group_by_at({{input$var12}}) %>%
  summarize(Mean = mean(!!sym(input$var9)),
            SD = sd(!!sym(input$var9)),
            Min = min(!!sym(input$var9)),
            Max = max(!!sym(input$var9)),
            Total = length(!!sym(input$var9))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(three_pi_tbl_1())
```

### Three Tests Plots - Test 2

```{r, include=TRUE}
renderPlotly({
  three_impact_test %>% 
    ggplot(aes_string(input$var10)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var12) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Three Tests Tables - Test 2

```{r, include=FALSE}
three_pi_tbl_2 <- reactive({
  three_impact_test %>%
  group_by_at({{input$var12}}) %>%
  summarize(Mean = mean(!!sym(input$var10)),
            SD = sd(!!sym(input$var10)),
            Min = min(!!sym(input$var10)),
            Max = max(!!sym(input$var10)),
            Total = length(!!sym(input$var10))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(three_pi_tbl_2())
```

### Three Tests Plots - Test 3

```{r, include=TRUE}
renderPlotly({
  three_impact_test %>% 
    ggplot(aes_string(input$var11)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var12) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Three Tests Tables - Test 3

```{r, include=FALSE}
three_pi_tbl_3 <- reactive({
  three_impact_test %>%
  group_by_at({{input$var12}}) %>%
  summarize(Mean = mean(!!sym(input$var11)),
            SD = sd(!!sym(input$var11)),
            Min = min(!!sym(input$var11)),
            Max = max(!!sym(input$var11)),
            Total = length(!!sym(input$var11))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(three_pi_tbl_3())
```

Row {.tabset}
-----------------------------------------------------------------------

### Four Tests Plots - Test 1 

```{r, include=TRUE}
renderPlotly({
  four_impact_test %>% 
    ggplot(aes_string(input$var13)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var17) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Four Tests Tables - Test 1

```{r, include=FALSE}
four_pi_tbl_1 <- reactive({
  four_impact_test %>%
  group_by_at({{input$var17}}) %>%
  summarize(Mean = mean(!!sym(input$var13)),
            SD = sd(!!sym(input$var13)),
            Min = min(!!sym(input$var13)),
            Max = max(!!sym(input$var13)),
            Total = length(!!sym(input$var13))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(four_pi_tbl_1())
```

### Four Tests Plots - Test 2

```{r, include=TRUE}
renderPlotly({
  four_impact_test %>% 
    ggplot(aes_string(input$var14)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var17) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Four Tests Tables - Test 2

```{r, include=FALSE}
four_pi_tbl_2 <- reactive({
  four_impact_test %>%
  group_by_at({{input$var17}}) %>%
  summarize(Mean = mean(!!sym(input$var14)),
            SD = sd(!!sym(input$var14)),
            Min = min(!!sym(input$var14)),
            Max = max(!!sym(input$var14)),
            Total = length(!!sym(input$var14))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(four_pi_tbl_2())
```


### Four Tests Plots - Test 3

```{r, include=TRUE}
renderPlotly({
  four_impact_test %>% 
    ggplot(aes_string(input$var15)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var17) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Four Tests Tables - Test 3

```{r, include=FALSE}
four_pi_tbl_3 <- reactive({
  four_impact_test %>%
  group_by_at({{input$var17}}) %>%
  summarize(Mean = mean(!!sym(input$var15)),
            SD = sd(!!sym(input$var15)),
            Min = min(!!sym(input$var15)),
            Max = max(!!sym(input$var15)),
            Total = length(!!sym(input$var15))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(four_pi_tbl_3())
```


### Four Tests Plots - Test 4

```{r, include=TRUE}
renderPlotly({
  four_impact_test %>% 
    ggplot(aes_string(input$var16)) +
    geom_histogram(bins = input$bins1,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var17) +
    labs(x = "Symptom Severity",
         y = "")
})
```

### Four Tests Tables - Test 4

```{r, include=FALSE}
four_pi_tbl_4 <- reactive({
  four_impact_test %>%
  group_by_at({{input$var17}}) %>%
  summarize(Mean = mean(!!sym(input$var16)),
            SD = sd(!!sym(input$var16)),
            Min = min(!!sym(input$var16)),
            Max = max(!!sym(input$var16)),
            Total = length(!!sym(input$var16))) %>%
    mutate(Mean = as.numeric(Mean),
         SD = as.numeric(SD),
         Min = as.numeric(Min),
         Max = as.numeric(Max),
         Total = as.numeric(Total)) %>%
    arrange(desc(Total)) %>%
    mutate_if(is.numeric, round, 2) %>%
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE)),
      SD = colDef(format = colFormat(separators = TRUE)),
      Min = colDef(format = colFormat(separators = TRUE)),
      Max = colDef(format = colFormat(separators = TRUE)),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })

```

```{r, include=TRUE}
renderReactable(four_pi_tbl_4())
```



# RTL/RTP by Number of Tests Completed 

Sidebar {.sidebar}
------------


**Demographic Variables**

```{r, include=TRUE}

selectInput("var18", "RTL/RTP Plots:",
            choices = c("Gender" = "gender",
                        "Age" = "age",
                        "League" = "league",
                        "Sport Level" = "level"))

selectInput("bins2", "Number of Bins",
            choices = c(10, 25, 40, 55), selected = 25)

selectInput("var19", "RTL/RTP Tables:",
            choices = c("Gender" = "gender",
                        "Age" = "age",
                        "League" = "league",
                        "School" = "school",
                        "Sport" = "sport",
                        "Sport Level" = "level"))

```


Row {.tabset}
-----------------------------------------------------------------------

### RTL One Test Plot

```{r, include=TRUE}
renderPlotly({
  one_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_3)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTL",
         y = "")
})
```

### RTL One Test Table

```{r, include=FALSE}
one_impact_rtl_tbl <- reactive({
  one_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_3),
            SD = sd(dys_btwn_onset_rtp_3),
            Min = min(dys_btwn_onset_rtp_3),
            Max = max(dys_btwn_onset_rtp_3),
            Total = length(dys_btwn_onset_rtp_3)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(one_impact_rtl_tbl())
```

### RTP One Test Plot

```{r, include=TRUE}
renderPlotly({
  one_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_7)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTP",
         y = "")
})
```

### RTP One Test Table

```{r, include=FALSE}
one_impact_rtp_tbl <- reactive({
  one_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_7),
            SD = sd(dys_btwn_onset_rtp_7),
            Min = min(dys_btwn_onset_rtp_7),
            Max = max(dys_btwn_onset_rtp_7),
            Total = length(dys_btwn_onset_rtp_7)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(one_impact_rtp_tbl())
```


Row {.tabset}
-----------------------------------------------------------------------

### RTL Two Tests Plot

```{r, include=TRUE}
renderPlotly({
  two_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_3)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTL",
         y = "")
})
```

### RTL Two Tests Table

```{r, include=FALSE}
two_impact_rtl_tbl <- reactive({
  two_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_3),
            SD = sd(dys_btwn_onset_rtp_3),
            Min = min(dys_btwn_onset_rtp_3),
            Max = max(dys_btwn_onset_rtp_3),
            Total = length(dys_btwn_onset_rtp_3)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(two_impact_rtl_tbl())
```

### RTP Two Tests Plot

```{r, include=TRUE}
renderPlotly({
  two_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_7)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTP",
         y = "")
})
```

### RTP Two Tests Table

```{r, include=FALSE}
two_impact_rtp_tbl <- reactive({
  two_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_7),
            SD = sd(dys_btwn_onset_rtp_7),
            Min = min(dys_btwn_onset_rtp_7),
            Max = max(dys_btwn_onset_rtp_7),
            Total = length(dys_btwn_onset_rtp_7)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(two_impact_rtp_tbl())
```



Row {.tabset}
-----------------------------------------------------------------------

### RTL Three Tests Plot

```{r, include=TRUE}
renderPlotly({
  three_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_3)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTL",
         y = "")
})
```

### RTL Three Tests Table

```{r, include=FALSE}
three_impact_rtl_tbl <- reactive({
  three_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_3),
            SD = sd(dys_btwn_onset_rtp_3),
            Min = min(dys_btwn_onset_rtp_3),
            Max = max(dys_btwn_onset_rtp_3),
            Total = length(dys_btwn_onset_rtp_3)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(three_impact_rtl_tbl())
```

### RTP Three Tests Plot

```{r, include=TRUE}
renderPlotly({
  three_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_7)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTP",
         y = "")
})
```

### RTP Three Tests Table

```{r, include=FALSE}
three_impact_rtp_tbl <- reactive({
  three_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_7),
            SD = sd(dys_btwn_onset_rtp_7),
            Min = min(dys_btwn_onset_rtp_7),
            Max = max(dys_btwn_onset_rtp_7),
            Total = length(dys_btwn_onset_rtp_7)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(three_impact_rtp_tbl())
```


Row {.tabset}
-----------------------------------------------------------------------

### RTL Four Tests Plot

```{r, include=TRUE}
renderPlotly({
  four_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_3)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTL",
         y = "")
})
```

### RTL Four Tests Table

```{r, include=FALSE}
four_impact_rtl_tbl <- reactive({
  four_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_3),
            SD = sd(dys_btwn_onset_rtp_3),
            Min = min(dys_btwn_onset_rtp_3),
            Max = max(dys_btwn_onset_rtp_3),
            Total = length(dys_btwn_onset_rtp_3)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
 renderReactable(four_impact_rtl_tbl())
```

### RTP Four Tests Plot

```{r, include=TRUE}
renderPlotly({
  four_impact_sims %>% 
    ggplot(aes(dys_btwn_onset_rtp_7)) +
    geom_histogram(bins = input$bins2,
                   fill = "#56B4E9",
                color = "white",
                alpha = 0.9) +
    facet_wrap(input$var18) +
    labs(x = "Days to Complete RTP",
         y = "")
})
```

### RTP Four Tests Table

```{r, include=FALSE}
four_impact_rtp_tbl <- reactive({
  four_impact_sims %>%
  group_by_at({{input$var19}}) %>%
  summarize(Mean = mean(dys_btwn_onset_rtp_7),
            SD = sd(dys_btwn_onset_rtp_7),
            Min = min(dys_btwn_onset_rtp_7),
            Max = max(dys_btwn_onset_rtp_7),
            Total = length(dys_btwn_onset_rtp_7)) %>% 
    arrange(desc(Total)) %>% 
    mutate_if(is.numeric, round, 2) %>% 
    reactable(
      defaultColDef = colDef(align = "center"),
      columns = list(
      Mean = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      SD = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Min = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Max = colDef(format = colFormat(separators = TRUE, suffix = " days")),
      Total = colDef(format = colFormat(separators = TRUE, suffix = " concussions"))  
      ),
    pagination = TRUE,
    striped = TRUE,
    outlined = TRUE,
    compact = TRUE,
    highlight = TRUE,
    bordered = TRUE
    )
  })
```

```{r, include=TRUE}
renderReactable(four_impact_rtp_tbl())
```

